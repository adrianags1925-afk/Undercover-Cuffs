<!doctype html>

<html lang="en" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>

<meta name="viewport" content="width=device-width, initial-scale=1.0">	
<meta charset="UTF-8">
<!-- Permisos para reproducci√≥n autom√°tica de audio -->
<meta http-equiv="Permissions-Policy" content="autoplay=(self), microphone=(), camera=(), speaker=(self)">
<meta name="referrer" content="no-referrer">
	
<title>Video - UndercoverCuffs.HTML</title>
	
<link href="css/UndercoverCuffs.css" rel="stylesheet" type="text/css">
	
    <style>
        body {
            background-color: #000000;
            background-image: none;
        }
        
        .video-container {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 40px 20px;
            background-color: #000000;
        }
        
        .video-wrapper {
            flex: 1;
            min-width: 300px;
            max-width: 600px;
            position: relative;
        }
        
        .video-wrapper video {
            width: 100%;
            height: auto;
            display: block;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        header {
            background-color: rgba(0, 0, 0, 0.9);
            padding: 20px;
            margin-bottom: 0;
        }
        
        header h1 {
            margin: 10px;
        }
        
        .navmenu a {
            color: #ffffff;
        }
        
        footer {
            background-color: rgba(0, 0, 0, 0.9);
            color: #ffffff;
            margin-top: 0;
        }
        
        @media only screen and (max-width: 768px) {
            .video-container {
                padding: 20px 10px;
                gap: 15px;
            }
            
            .video-wrapper {
                min-width: 100%;
                max-width: 100%;
            }
            
            header {
                padding: 0 5px;
            }
            
            header h1 {
                font-size: clamp(1.2rem, 5vw, 2rem) !important;
                padding: 8px 15px;
                margin: 5px;
            }
            
            .navmenu {
                gap: 8px;
                flex-direction: column;
            }
            
            .navmenu li {
                width: 100%;
            }
            
            .navmenu a {
                display: block;
                padding: 8px 15px;
                font-size: clamp(0.85rem, 3vw, 1rem);
            }
            
            footer {
                margin-top: 30px;
                padding: 15px 0;
                font-size: clamp(1rem, 3vw, 1.6rem);
            }
        }
        
        @media only screen and (max-width: 480px) {
            .video-container {
                padding: 15px 5px;
                gap: 10px;
            }
            
            .video-wrapper {
                min-width: 100%;
                max-width: 100%;
            }
            
            header {
                padding: 0;
            }
            
            header h1 {
                font-size: clamp(1rem, 6vw, 1.5rem) !important;
                padding: 6px 10px;
                margin: 5px;
            }
            
            .navmenu {
                gap: 5px;
            }
            
            .navmenu a {
                padding: 6px 10px;
                font-size: clamp(0.75rem, 3.5vw, 0.9rem);
            }
            
            footer {
                padding: 12px 0;
                font-size: clamp(0.9rem, 3.5vw, 1.4rem);
            }
        }
        
        /* Audio de fondo oculto */
        #background-audio {
            display: none;
        }
    </style>
	
</head>

<body>

<!-- ESTA ES LA CABECERA CON EL MEN√ö -->

<header>   
    <h1>Undercover Cuffs</h1>

<nav>
    <ul class="navmenu">
        <li><a href="index.html">Home</a></li>
        <li><a href="characters.html">Characters</a></li>
        <li><a href="video.html">Video</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="comments.html">Comments</a></li>
    </ul>
</nav>

</header>

<!-- CONTENEDOR DE VIDEOS -->
<div class="video-container">
    <div class="video-wrapper">
        <video loop autoplay muted playsinline>
            <source src="videos/IMG_0-2.MOV" type="video/mp4">
            Tu navegador no soporta el elemento de video.
        </video>
    </div>
    
    <!-- Puedes agregar m√°s videos aqu√≠ si los tienes -->
    <!--
    <div class="video-wrapper">
        <video loop autoplay muted playsinline>
            <source src="videos/otro-video.mp4" type="video/mp4">
            Tu navegador no soporta el elemento de video.
        </video>
    </div>
    -->
</div>

<!-- PIE DE P√ÅGINA -->
<footer>
    <a href="office.html" class="footer-hidden-link" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0; opacity: 0; cursor: pointer; text-decoration: none; z-index: 1; display: block;" aria-label="Office" title="Office"></a>
    <span style="position: relative; z-index: 0; pointer-events: none;">Undercover Cuffs</span>
</footer>

<!-- M√∫sica de fondo (sin controles visibles) -->
<!-- playsinline es CR√çTICO para iOS -->
<audio id="background-audio" loop preload="auto" playsinline webkit-playsinline style="display: none;">
    <!-- M√∫sica alegre pero tranquila libre de derechos de autor -->
    <!-- Pixabay - m√∫sica tranquila y alegre -->
    <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_73b40dc47e.mp3?filename=soft-background-music-112791.mp3" type="audio/mpeg">
    <!-- Fallback: Pixabay (m√∫sica tranquila alternativa) -->
    <source src="https://cdn.pixabay.com/download/audio/2023/05/11/audio_1683814731.mp3?filename=peaceful-morning-118490.mp3" type="audio/mpeg">
    <!-- Fallback adicional: SoundHelix -->
    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" type="audio/mpeg">
    Tu navegador no soporta el elemento de audio.
</audio>

<script>
    // Sistema de reproducci√≥n de m√∫sica de fondo - SOLUCI√ìN ROBUSTA PARA M√ìVILES
    (function() {
        'use strict';
        
        const audio = document.getElementById('background-audio');
        if (!audio) {
            console.error('Elemento de audio no encontrado');
            return;
        }
        
        // Configurar audio para m√≥viles
        audio.volume = 0.3;
        audio.muted = false;
        
        // CR√çTICO para iOS: establecer playsinline mediante JavaScript tambi√©n
        if ('playsInline' in audio) {
            audio.playsInline = true;
        }
        audio.setAttribute('playsinline', 'true');
        audio.setAttribute('webkit-playsinline', 'true');
        
        let musicPlaying = false;
        let userInteracted = false;
        let audioReady = false;
        
        // Detectar si es un dispositivo m√≥vil
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                        ('ontouchstart' in window) || 
                        (navigator.maxTouchPoints > 0);
        
        // Solicitar permisos de audio expl√≠citamente
        function requestAudioPermissions() {
            // Intentar solicitar permisos de autoplay
            if ('permissions' in navigator && 'query' in navigator.permissions) {
                // Permisos de autoplay
                navigator.permissions.query({ name: 'autoplay' }).then(function(result) {
                    if (result.state === 'granted') {
                        console.log('‚úÖ Permisos de autoplay concedidos');
                    } else if (result.state === 'prompt') {
                        console.log('‚ö†Ô∏è Permisos de autoplay pendientes');
                    } else {
                        console.log('‚ùå Permisos de autoplay denegados');
                    }
                }).catch(function(error) {
                    console.log('‚ÑπÔ∏è API de permisos de autoplay no disponible');
                });
                
                // Intentar solicitar permisos de speaker/audio si est√° disponible
                try {
                    navigator.permissions.query({ name: 'speaker-selection' }).then(function(result) {
                        if (result.state === 'granted') {
                            console.log('‚úÖ Permisos de audio/speaker concedidos');
                        }
                    }).catch(function(error) {
                        // Esta API puede no estar disponible en todos los navegadores
                    });
                } catch (e) {
                    // La API puede no existir
                }
            }
            
            // Solicitar permisos de audio mediante el contexto de audio (Web Audio API)
            if (window.AudioContext || window.webkitAudioContext) {
                try {
                    var AudioContextClass = window.AudioContext || window.webkitAudioContext;
                    var audioContext = new AudioContextClass();
                    
                    // Si el contexto est√° suspendido, intentar reanudarlo
                    if (audioContext.state === 'suspended') {
                        audioContext.resume().then(function() {
                            console.log('‚úÖ Contexto de audio activado');
                        }).catch(function(error) {
                            console.log('‚ö†Ô∏è No se pudo activar el contexto de audio:', error);
                        });
                    }
                    
                    // Cerrar el contexto despu√©s de usarlo
                    setTimeout(function() {
                        if (audioContext && audioContext.close) {
                            audioContext.close().catch(function() {});
                        }
                    }, 100);
                } catch (e) {
                    console.log('‚ÑπÔ∏è Web Audio API no disponible');
                }
            }
        }
        
        // Solicitar permisos al cargar la p√°gina
        requestAudioPermissions();
        
        // Tambi√©n solicitar permisos cuando el usuario interact√∫e
        var permissionsRequested = false;
        function requestPermissionsOnInteraction() {
            if (!permissionsRequested) {
                permissionsRequested = true;
                requestAudioPermissions();
            }
        }
        
        // Solicitar permisos en la primera interacci√≥n
        document.addEventListener('click', requestPermissionsOnInteraction, { once: true });
        document.addEventListener('touchstart', requestPermissionsOnInteraction, { once: true });
        document.addEventListener('keydown', requestPermissionsOnInteraction, { once: true });
        
        // Funci√≥n robusta para reproducir m√∫sica
        function playMusic(force) {
            if (!audioReady && !force) {
                return;
            }
            
            // Si ya est√° reproduci√©ndose, no hacer nada
            if (musicPlaying && !audio.paused && !audio.ended) {
                return;
            }
            
            // Asegurar que no est√© muted
            audio.muted = false;
            
            // Intentar reproducir
            const playPromise = audio.play();
            
            if (playPromise !== undefined) {
                playPromise
                    .then(function() {
                        musicPlaying = true;
                        audio.muted = false;
                        console.log('‚úÖ M√∫sica reproduci√©ndose');
                    })
                    .catch(function(error) {
                        if (isMobile && !userInteracted) {
                            console.log('‚ö†Ô∏è Autoplay bloqueado en m√≥vil. La m√∫sica se activar√° al tocar la pantalla.');
                        }
                    });
            }
        }
        
        // Funci√≥n para iniciar m√∫sica en interacci√≥n (MUY AGRESIVA para m√≥viles)
        function startMusicOnInteraction(e) {
            if (musicPlaying && !audio.paused) {
                return;
            }
            
            // Marcar interacci√≥n
            if (!userInteracted) {
                userInteracted = true;
                console.log('üëÜ Usuario interactu√≥ - Iniciando m√∫sica...');
            }
            
            // Asegurar que el audio est√© listo
            if (!audioReady) {
                audio.load();
                audioReady = true;
            }
            
            // Forzar reproducci√≥n inmediata
            audio.muted = false;
            
            // En m√≥viles, intentar m√∫ltiples veces
            if (isMobile) {
                // Intento inmediato
                playMusic(true);
                
                // Intentos con delays para asegurar
                var attempts = [10, 50, 100, 200, 300, 500, 800, 1000];
                attempts.forEach(function(delay) {
                    setTimeout(function() {
                        if (!musicPlaying || audio.paused) {
                            audio.muted = false;
                            playMusic(true);
                        }
                    }, delay);
                });
            } else {
                playMusic(true);
            }
        }
        
        // Listener √∫nico y global para capturar CUALQUIER interacci√≥n
        function setupGlobalListener() {
            var handler = function(e) {
                startMusicOnInteraction(e);
            };
            
            // Eventos cr√≠ticos para m√≥viles (sin 'once' para capturar m√∫ltiples veces)
            var events = ['touchstart', 'touchend', 'click', 'scroll', 'wheel', 'mousedown', 'keydown'];
            
            events.forEach(function(eventType) {
                // Capturar en fase de captura (m√°s temprano)
                document.addEventListener(eventType, handler, { capture: true, passive: true });
                window.addEventListener(eventType, handler, { capture: true, passive: true });
                
                if (document.body) {
                    document.body.addEventListener(eventType, handler, { capture: true, passive: true });
                }
            });
        }
        
        // Cuando el audio est√© listo
        function onAudioReady() {
            audioReady = true;
            console.log('üéµ Audio listo para reproducir');
            
            if (userInteracted || !isMobile) {
                playMusic(true);
            }
        }
        
        // Event listeners para cuando el audio est√© cargado
        audio.addEventListener('canplay', onAudioReady, { once: false });
        audio.addEventListener('canplaythrough', onAudioReady, { once: false });
        audio.addEventListener('loadeddata', function() {
            audioReady = true;
            if (userInteracted || !isMobile) {
                setTimeout(function() { playMusic(true); }, 100);
            }
        }, { once: false });
        
        // Cargar el audio
        audio.load();
        
        // Configurar listeners INMEDIATAMENTE
        setupGlobalListener();
        
        // Tambi√©n configurar cuando el DOM est√© listo
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setupGlobalListener();
                setTimeout(function() {
                    if (userInteracted || !isMobile) {
                        playMusic(true);
                    }
                }, 500);
            });
        } else {
            setTimeout(function() {
                if (userInteracted || !isMobile) {
                    playMusic(true);
                }
            }, 500);
        }
        
        // Cuando la p√°gina cargue completamente
        window.addEventListener('load', function() {
            audioReady = true;
            setTimeout(function() {
                if (userInteracted || !isMobile) {
                    playMusic(true);
                }
            }, 800);
        }, { once: true });
        
        // Manejar cuando el audio termine (reiniciar loop)
        audio.addEventListener('ended', function() {
            audio.currentTime = 0;
            if (userInteracted || musicPlaying) {
                audio.play().catch(function() {});
            }
        });
        
        // Mantener la m√∫sica reproduci√©ndose si se pausa
        audio.addEventListener('pause', function() {
            if (userInteracted && !audio.ended) {
                setTimeout(function() {
                    if (audio.paused && userInteracted) {
                        audio.muted = false;
                        audio.play().catch(function() {});
                    }
                }, 200);
            }
        });
        
        // Verificar peri√≥dicamente el estado (m√°s frecuente en m√≥viles)
        var checkInterval = isMobile ? 300 : 1000;
        setInterval(function() {
            if (userInteracted && audioReady) {
                if (audio.paused && !audio.ended) {
                    audio.muted = false;
                    audio.play()
                        .then(function() {
                            musicPlaying = true;
                        })
                        .catch(function() {});
                }
                // Si la m√∫sica termin√≥, reiniciar
                if (musicPlaying && audio.ended) {
                    audio.currentTime = 0;
                    audio.muted = false;
                    audio.play().catch(function() {});
                }
            }
        }, checkInterval);
        
        // En m√≥viles, listeners adicionales
        if (isMobile) {
            // Cuando la p√°gina vuelva a estar visible
            document.addEventListener('visibilitychange', function() {
                if (!document.hidden && userInteracted && audioReady) {
                    setTimeout(function() {
                        audio.muted = false;
                        playMusic(true);
                    }, 200);
                }
            });
            
            // Cuando cambie la orientaci√≥n
            window.addEventListener('orientationchange', function() {
                setTimeout(function() {
                    if (userInteracted && audioReady) {
                        audio.muted = false;
                        playMusic(true);
                    }
                }, 500);
            });
            
            // Intentar reproducir despu√©s de que el usuario haga cualquier acci√≥n
            window.addEventListener('focus', function() {
                if (userInteracted && audioReady) {
                    setTimeout(function() {
                        audio.muted = false;
                        playMusic(true);
                    }, 200);
                }
            });
        }
        
        // Debugging
        audio.addEventListener('error', function(e) {
            console.error('‚ùå Error al cargar el audio:', e);
            if (audio.error) {
                console.log('C√≥digo:', audio.error.code, 'Mensaje:', audio.error.message);
            }
        });
        
        audio.addEventListener('loadedmetadata', function() {
            console.log('‚úÖ Metadata cargada. Duraci√≥n:', audio.duration, 's');
        });
        
        audio.addEventListener('play', function() {
            console.log('‚ñ∂Ô∏è M√∫sica iniciada');
            musicPlaying = true;
        });
        
        audio.addEventListener('playing', function() {
            console.log('üéµ M√∫sica reproduci√©ndose');
            musicPlaying = true;
        });
        
        if (isMobile) {
            console.log('üì± Dispositivo m√≥vil detectado. Toca la pantalla para activar la m√∫sica.');
        }
    })();
</script>

<script>
    // Asegurar que los videos se reproduzcan en loop
    document.addEventListener('DOMContentLoaded', function() {
        const videos = document.querySelectorAll('video');
        videos.forEach(video => {
            video.loop = true;
            video.autoplay = true;
            video.muted = true;
            video.playsInline = true;
            
            // Si el video se detiene, volver a reproducirlo
            video.addEventListener('ended', function() {
                this.currentTime = 0;
                this.play();
            });
            
            // Intentar reproducir el video
            video.play().catch(error => {
                console.log('Error al reproducir video:', error);
            });
        });
    });
</script>
	
</body>
</html>

